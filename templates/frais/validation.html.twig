{% extends 'base.html.twig' %}
{% block body %}
<div class="container mx-auto round" id='contenu'>
    <div class="row " id='entete2'>
        <div class="col-4">
            <a href="index.php
            "><img src="{{asset('images/GSB.png')}}" alt="logo"></a>

        </div>
        <div class="col-8 d-flex justify-content-center">
            <h1 class="text-white  my-auto ">Valider fiche de frais</h1>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-4">

        </div>
        <div class="col-8">

            <div id="criteresRecherche">
                <form method='POST' id="critere" action="{{path('sendFiche')}}">
                    <div class="form-inline">

                        <label for="visiteur">
                            <h4 class="text-white">Visiteur :</h4>
                        </label> 
                        <select class="form-control" name="visiteur" id="visiteur" onchange="getMois()"> 
                        <option value="">Veuillez selectionner un visiteur</option>                      
                            {% for visiteur in visiteurs %}
              <option value="{{visiteur.id}}" >{{visiteur.nom}} </option>
                              
                             {% endfor %}      
                        </select>
                        <label class="" for="mois">
                            <h4 class=" ml-4 mr-2 text-white">
                                Mois
                            </h4>
                        </label>
                        <select class="form-control" name='mois' id="mois" onchange="getFiche()">

                        </select>


                    </div>


                </form>

            </div>

        </div>

    </div>
{% if frais is defined %}
   {{include('frais/frais-tab.html.twig')}}
   {% endif %}
{% endblock %}
 {% block javascripts %}
<script>

    getMois = () => {
       {
           $.ajax({
            type: 'GET',
            url: '{{ path('sendMois') }}',
            data: {
                id: $("#visiteur").val(),
            },
            dataType: 'json',
            success: function(data) {
                document.getElementById("mois").innerHTML = "";
                $.each(data, function(i, obj) {
                    var option = document.createElement('option');
                    option.value = obj.mois;
                    option.innerHTML = obj.mois.substr(4)+ '/'+  obj.mois.substr(0,4);
                    document.getElementById("mois").appendChild(option);
                })
            },
            error: function(data) {
                alert('Récupération des donées impossible');
            }
        });

       } }

 getFiche = () => {
       {
           let data = $("#critere").serialize();
           $.ajax({
            type: 'GET',
            url: '{{ path('sendFiche') }}',
            data: {
                 data
            },
            dataType: 'json',
            success: function(data) {
               alert('cc');
            },
            error: function(data) {
                alert('Récupération des donées impossible');
            }
        });

       } }

</script>

{% endblock %}